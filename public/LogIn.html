<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title> Welcome to QuickNote </title>
    <link rel="stylesheet" href="public/logIn/css/reset.css">
    <link rel="stylesheet" href="public/logIn/css/googleapis.css">
    <!-- <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900|RobotoDraft:400,100,300,500,700,900'> -->
    <link href="public/css/font-awesome-4.2.0/css/font-awesome-min.css" rel="stylesheet" />
    <link rel="stylesheet" href="public/logIn/css/style.css">
  </head>

  <body>
    <div class="pen-title">
          <a href="http://quicknote.cc" target="_blank"><img id = "logo" src="public/images/logo/Quicknote.png" height = 100></a>
<!--       <span>Q-Note by <a href='http://unnc-cs-grp-dtgroup.github.io/Notebook-NW.js/'>GRPDT</a>
      </span> -->
    </div>
    <!-- <div class="rerun"><a href="http://unnc-cs-grp-dtgroup.github.io/Notebook-NW.js/">Q-Note page</a></div> -->
    <div class="rerun"><a href="http://www.sojump.com/jq/7951507.aspx" target="_blank">Give us feedback</a></div>
    <div class="container">
      <div class="card"></div>
      <div class="card">
        <h1 class="title">Login</h1>
        <form>
          <div class="input-container">
            <input type="text" id="Username" required="required"/>
            <label for="Username">Username</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="Password" required="required"/>
            <label for="Password">Password</label>
            <div class="bar"></div>
          </div>
          <div class="button-container">
            <button id="loginBtn"><span>Sign in</span></button>
          </div>
<!--          <div class="footer"><a href="#">Forgot your password?</a></div>-->
        </form>
      </div>
      <div class="card alt">
        <div class="toggle"></div>
        <h1 class="title">Register
          <div class="close"></div>
        </h1>
        <form>
          <div class="input-container">
            <input type="text" id="Username2" required="required"/>
            <label for="Username">Username</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="Password2" required="required"/>
            <label for="Password">Password</label>
            <div class="bar"></div>
          </div>
          <div class="input-container">
            <input type="password" id="RepeatPassword" required="required"/>
            <label for="Repeat Password">Repeat Password</label>
            <div class="bar" ></div>
          </div>
          <div class="button-container">
            <button id="regBtn"><span>Register</span></button>
          </div>
        </form>
      </div>
    </div>
    <script src="public/js/dep.min.js"></script>
    <script src="public/data/localForage-1.4.0/dist/localforage.js"></script>
    <script src="public/js/logIn.js"></script> 
    <link href="public/css/bootstrap-min.css" rel="stylesheet" />
    <script type="text/javascript" src="public/js/bootbox.min.js"></script>
    <script src="public/js/i18n/msg.en.js"></script>
    
    <script>
        // var baseUrl = "http:\/\/115.28.134.156:3000\/";
        var baseUrl = "http:\/\/10.160.1.25:80\/";
        var allAppData = {};
        
        // register event handlers
        $("#loginBtn").click(logIn); // logIn/register take "this event" as argument automatically
        $("#regBtn").click(register);

        require('nw.gui').Window.get().setResizable(true);
        require('nw.gui').Window.get().resizeTo(400,600);
        require('nw.gui').Window.get().zoomLevel=-2.5;
      </script>>

      <script>
      /*

       1. Check the manifest for version (from your running "old" app).
       2. If the version is different from the running one, download new package to a temp directory.
       3. Unpack the package in temp.
       4. Run new app from temp and kill the old one (i.e. still all from the running app).
       5. The new app (in temp) will copy itself to the original folder, overwriting the old app.
       6. The new app will run itself from original folder and exit the process.

      */

      var gui = require('nw.gui');
      var pkg = require('package.json'); // Insert your app's manifest here
      var updater = require('node-webkit-updater');
      var upd = new updater(pkg);
      var copyPath, execPath;

      // Args passed when new app is launched from temp dir during update
      if(gui.App.argv.length) {
          // ------------- Step 5 -------------
          copyPath = gui.App.argv[0];
          execPath = gui.App.argv[1];

          // Replace old app, Run updated app from original location and close temp instance
          upd.install(copyPath, function(err) {
              if(!err) {
                  // ------------- Step 6 -------------
                  upd.run(execPath, null);
                  gui.App.quit();
              }
          });
      }
      else { // if no arguments were passed to the app

          // ------------- Step 1 -------------
          upd.checkNewVersion(function(error, newVersionExists, manifest) {
              if (!error && newVersionExists) {
                  console.log("find new version");
                  // ------------- Step 2 -------------
                  upd.download(function(error, filename) {
                      if (!error) {
                          console.log("download successfully");
                          // ------------- Step 3 -------------
                          upd.unpack(filename, function(error, newAppPath) {
                              if (!error) {
                                  console.log("unpack successfully");
                                  // ------------- Step 4 -------------
                                  console.log("newAppPath is: " + newAppPath);
                                  newAppPath = "/var/folders/qk/y0_813td04l3s63yb0qqnk180000gn/T/Q-Note_MAC_1.0.2/QuickNote.app"
                                  upd.runInstaller(newAppPath, [upd.getAppPath(), upd.getAppExec()],{});
                                  console.log("run successfully");
                                  gui.App.quit();

                                  // console.log("copyPath is: " + copyPath);
                                  // upd.install(copyPath, newAppInstalled);
    
                                  // function newAppInstalled(err) {
                                  //   if(err){
                                  //     console.log("install failed");
                                  //     console.log(err);
                                  //     gui.App.quit();
                                  //     return;
                                  //   }
                                  //   console.log("install successfully");
                                  //   upd.run(execPath, null);
                                  //   console.log("run successfully");
                                  //   gui.App.quit();
                                  // };
                              }
                          }, manifest);
                      }
                      else {
                        console.log("download failed");
                      }
                  }, manifest);
              }
              else {
                console.log("error or no new version");
              }
          });
      }



      // var gui = require('nw.gui');
      // var copyPath, execPath;
      // if(gui.App.argv.length){
      //   copyPath = gui.App.argv[0];
      //   execPath = gui.App.argv[1];
      // }



      // //download new version of app in tmp
      // //unpack
      // //run updater
      // //updater will copy itself to origin directory
      // //updater will run app
      // var pkg = require('package.json');
      // var request = require('request');
      // var url = require('url');
      // var path = require('path');
      // var os = require('os');
      // var fs = require('fs');
      // var k = 0;
      // var d = false;
      // var updater = require('updater.js');
      // var upd = new updater(pkg);
      // var newVersionCheckIntervalId = null;
      // var tryingForNewVersion = false;
      
      // //for test purposes
      
      
      // if(!copyPath){
      //   request.get(url.resolve(pkg.manifestUrl, '/version/'+ pkg.version));
      //   // document.getElementById('version').innerHTML = 'current version ' + pkg.version;
      //   newVersionCheckIntervalId = setInterval(function(){
      //     if(!d && !tryingForNewVersion) {
      //         tryingForNewVersion = true; //lock
      //         upd.checkNewVersion(versionChecked);
      //     }
      //   }, 500);
      // } else {
      //   // document.getElementById('version').innerHTML = 'copying app';
      //   upd.install(copyPath, newAppInstalled);
        
      //   function newAppInstalled(err){
      //     if(err){
      //       console.log(err);
      //       return;
      //     }
      //     upd.run(execPath, null);
      //     gui.App.quit();
      //   }
      // }

      // function versionChecked(err, newVersionExists, manifest){
      //   tryingForNewVersion = false; //unlock
      //   if(err){
      //       console.log(err);
      //       return Error(err);
      //   }
      //   else if(d){
      //       console.log('Already downloading');
      //       return;
      //   }
      //   else if(!newVersionExists){
      //       console.log('No new version exists');
      //       return;
      //   }
      //   d = true;
      //   clearInterval(newVersionCheckIntervalId);
      //   var loaded = 0;
      //   var newVersion = upd.download(function(error, filename){
      //       newVersionDownloaded(error, filename, manifest);
      //   }, manifest);

      //   newVersion.on('data', function(chunk){
      //     loaded+=chunk.length;
      //     // document.getElementById('loaded').innerHTML = "New version loading " + Math.floor(loaded / newVersion['content-length'] * 100) + '%';
      //   })
      // }

      // function newVersionDownloaded(err, filename, manifest){
      //   if(err){
      //     console.log(err)
      //     return Error(err);
      //   }
      //   // document.getElementById('loaded').innerHTML = "unpacking: " + filename;
      //   upd.unpack(filename, newVersionUnpacked, manifest);
      // }

      // function newVersionUnpacked(err, newAppPath){
      //   if(err){
      //     console.log(err)
      //     return Error(err);
      //   }
      //   var runner = upd.runInstaller(newAppPath, [upd.getAppPath(), upd.getAppExec()]);
      //   gui.App.quit();
      // }
    </script>
  </body>
</html>
